{"ast":null,"code":"import _defineProperty from\"/Users/desireebradish/news-explorer-frontend/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/desireebradish/news-explorer-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/desireebradish/news-explorer-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useCallback}from'react';import{Route,Switch,useLocation,useHistory}from'react-router-dom';import Header from'../Header/Header';import Main from'../Main/Main';import SavedNews from'../SavedNews/SavedNews';import LoginPopup from'../LoginPopup/LoginPopup';import ConfirmationPopup from'../ConfirmationPopup/ConfirmationPopup';import RegisterPopup from'../RegisterPopup/RegisterPopup';import Footer from'../Footer/Footer';import'./App.css';import{mainApi}from'../../utils/MainApi';import CurrentUserContext from\"../../contexts/CurrentUserContext\";import ProtectedRoute from\"../ProtectedRoute/ProtectedRoute\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function App(){/* State Variables */var _useState=useState(false),_useState2=_slicedToArray(_useState,2),Loggedin=_useState2[0],setLoggedin=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isRegisterPopupOpen=_useState4[0],setRegisterPopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLoginPopupOpen=_useState6[0],setLoginPopupOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isConfirmationPopupOpen=_useState8[0],setConfirmationPopupOpen=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isMobile=_useState10[0],setIsMobile=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isMobileNavOpen=_useState12[0],setMobileNavOpen=_useState12[1];var _React$useState=React.useState(window.innerWidth),_React$useState2=_slicedToArray(_React$useState,2),screenWidth=_React$useState2[0],setScreenWidth=_React$useState2[1];var _React$useState3=React.useState({}),_React$useState4=_slicedToArray(_React$useState3,2),currentUser=_React$useState4[0],setCurrentUser=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),wrongEmailOrPasswordMessage=_React$useState6[0],setWrongEmailOrPasswordMessage=_React$useState6[1];var location=useLocation();var history=useHistory();var savedNewsLocation=location.pathname==='/saved-news';var _React$useState7=React.useState({email:'',password:'',username:''}),_React$useState8=_slicedToArray(_React$useState7,2),values=_React$useState8[0],setValues=_React$useState8[1];var _React$useState9=React.useState({}),_React$useState10=_slicedToArray(_React$useState9,2),errors=_React$useState10[0],setErrors=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isValid=_React$useState12[0],setIsValid=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),duplicateEmail=_React$useState14[0],setDuplicateEmail=_React$useState14[1];React.useEffect(function(){//debugger;\nhandleCheckToken();},[]);React.useEffect(function(){if(localStorage.getItem(\"token\")){getUser();}},[]);function handleCheckToken(){var jwt=localStorage.getItem(\"token\");if(jwt){console.log(\"I see the jwt\");mainApi.checkToken(jwt).then(function(res){if(res){setLoggedin(true);setValues({email:res.email,password:res.password,username:res.username});console.log(res);history.push('/');}}).catch(function(err){console.log(\"Err: \"+err);});}}function fieldValidation(){var validEmailRegex=RegExp(/^\\w+([.-]?\\w+)*@\\w+([.-]?\\w+)*(\\.\\w{2,3})+$/i);setErrors(function(origErrors){return _objectSpread(_objectSpread({},origErrors),{},{email:validEmailRegex.test(values.email)?\"\":\"Invalid email address\"});});}function handleSignup(e){e.preventDefault();mainApi.register(values.email,values.password,values.username).then(function(res){if(res.message==='Duplicate User'){setDuplicateEmail(true);return Promise.reject(\"Error! \".concat(res.message));}if(res.ok){return res.json();}}).then(function(){setConfirmationPopupOpen(true);setRegisterPopupOpen(false);setDuplicateEmail(false);resetForm();}).catch(function(err){return console.log(err);});}// Handle Form Typing\nvar handleChangeForm=function handleChangeForm(e){var _e$target=e.target,name=_e$target.name,value=_e$target.value;var newValues=_objectSpread(_objectSpread({},values),{},_defineProperty({},name,value));setValues(newValues);fieldValidation(newValues);setErrors(_objectSpread(_objectSpread({},errors),{},_defineProperty({},name,errors[name])));setIsValid(e.target.closest('form').checkValidity());};var resetForm=useCallback(function(){var newValues=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{email:'',password:'',username:''};var newErrors=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{email:'',password:'',username:''};var newIsValid=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;setValues(newValues);setErrors(newErrors);setIsValid(newIsValid);},[setValues,setErrors,setIsValid]);function getUser(){mainApi.getUserInfo().then(function(res){setCurrentUser(res);}).catch(function(err){console.log(err);});}function handleSignIn(e){e.preventDefault();mainApi.authorize(values.email,values.password).then(function(res){if(res.message===\"Authorization Error\"){console.log(res);setWrongEmailOrPasswordMessage(true);return Promise.reject(\"Error! \".concat(res.message));}localStorage.setItem('jwt',res.token);getUser();}).then(function(){handleCheckToken();closeAllPopups();resetForm();// window.location.reload();\n}).catch(function(res){if(res===400){console.log('one of the fields was filled in in correctly');}if(res===401){console.log('user email not found');}});}function handleSignOut(e){e.preventDefault();localStorage.removeItem('token');setLoggedin(false);history.push('/');closeAllPopups();window.location.reload();}function closeAllPopups(){setLoginPopupOpen(false);setRegisterPopupOpen(false);setMobileNavOpen(false);setConfirmationPopupOpen(false);}function handleSigninClick(){setLoginPopupOpen(true);setRegisterPopupOpen(false);setMobileNavOpen(false);setConfirmationPopupOpen(false);}function handleRegisterLinkClick(){setRegisterPopupOpen(true);setLoginPopupOpen(false);setWrongEmailOrPasswordMessage(false);}function handleMobileClick(){setMobileNavOpen(true);}function handleMobileClose(){setMobileNavOpen(false);}React.useEffect(function(){var handleScreenSizeChange=function handleScreenSizeChange(){return setScreenWidth(window.innerWidth);};window.addEventListener(\"resize\",handleScreenSizeChange);setIsMobile(screenWidth<768);return function(){return window.removeEventListener(\"resize\",handleScreenSizeChange);};},[screenWidth]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{values:values,loggedin:Loggedin,savedNewsLocation:savedNewsLocation,onSigninClick:handleSigninClick,onSignOut:handleSignOut,mobile:isMobile,mobileNavOpen:isMobileNavOpen,onHamburgerClick:handleMobileClick,onClose:handleMobileClose}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",children:/*#__PURE__*/_jsx(Main,{})}),/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/saved-news\",component:SavedNews,loggedin:Loggedin,savedNewsLocation:savedNewsLocation,currentUser:currentUser})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(LoginPopup,{onSignupClick:handleRegisterLinkClick,onClose:closeAllPopups,isOpen:isLoginPopupOpen,onSubmit:handleSignIn,handleChangeForm:handleChangeForm,values:values,isValid:isValid,wrongEmailOrPasswordMessage:wrongEmailOrPasswordMessage}),/*#__PURE__*/_jsx(RegisterPopup,{onSigninClick:handleSigninClick,onClose:closeAllPopups,isOpen:isRegisterPopupOpen,onSubmit:handleSignup,handleChangeForm:handleChangeForm,values:values,duplicateEmail:duplicateEmail,isValid:isValid}),/*#__PURE__*/_jsx(ConfirmationPopup,{onSigninClick:handleSigninClick,onClose:closeAllPopups,isOpen:isConfirmationPopupOpen})]})})});}export default App;","map":{"version":3,"sources":["/Users/desireebradish/news-explorer-frontend/src/components/App/App.js"],"names":["React","useState","useCallback","Route","Switch","useLocation","useHistory","Header","Main","SavedNews","LoginPopup","ConfirmationPopup","RegisterPopup","Footer","mainApi","CurrentUserContext","ProtectedRoute","App","Loggedin","setLoggedin","isRegisterPopupOpen","setRegisterPopupOpen","isLoginPopupOpen","setLoginPopupOpen","isConfirmationPopupOpen","setConfirmationPopupOpen","isMobile","setIsMobile","isMobileNavOpen","setMobileNavOpen","window","innerWidth","screenWidth","setScreenWidth","currentUser","setCurrentUser","wrongEmailOrPasswordMessage","setWrongEmailOrPasswordMessage","location","history","savedNewsLocation","pathname","email","password","username","values","setValues","errors","setErrors","isValid","setIsValid","duplicateEmail","setDuplicateEmail","useEffect","handleCheckToken","localStorage","getItem","getUser","jwt","console","log","checkToken","then","res","push","catch","err","fieldValidation","validEmailRegex","RegExp","origErrors","test","handleSignup","e","preventDefault","register","message","Promise","reject","ok","json","resetForm","handleChangeForm","target","name","value","newValues","closest","checkValidity","newErrors","newIsValid","getUserInfo","handleSignIn","authorize","setItem","token","closeAllPopups","handleSignOut","removeItem","reload","handleSigninClick","handleRegisterLinkClick","handleMobileClick","handleMobileClose","handleScreenSizeChange","addEventListener","removeEventListener"],"mappings":"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","sourcesContent":["import React, { useState, useCallback } from 'react';\nimport { Route, Switch, useLocation, useHistory} from 'react-router-dom';\nimport Header from '../Header/Header';\nimport Main from '../Main/Main';\nimport SavedNews from '../SavedNews/SavedNews';\nimport LoginPopup from '../LoginPopup/LoginPopup';\nimport ConfirmationPopup from '../ConfirmationPopup/ConfirmationPopup';\nimport RegisterPopup from '../RegisterPopup/RegisterPopup';\nimport Footer from '../Footer/Footer';\nimport './App.css'; \nimport { mainApi } from '../../utils/MainApi';\nimport CurrentUserContext from \"../../contexts/CurrentUserContext\";\nimport ProtectedRoute from \"../ProtectedRoute/ProtectedRoute\";\n\n function App() {\n /* State Variables */\n  const [Loggedin, setLoggedin] = useState(false);\n  const [isRegisterPopupOpen, setRegisterPopupOpen] = useState(false);\n  const [isLoginPopupOpen, setLoginPopupOpen] = useState(false);\n  const [isConfirmationPopupOpen, setConfirmationPopupOpen] = useState(false);\n  const [isMobile, setIsMobile] = useState(false);\n  const [isMobileNavOpen, setMobileNavOpen] = useState(false);\n  const [screenWidth, setScreenWidth] = React.useState(window.innerWidth);\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [wrongEmailOrPasswordMessage, setWrongEmailOrPasswordMessage] = React.useState(false)\n  const location = useLocation();\n  const history= useHistory();\n const savedNewsLocation = location.pathname === '/saved-news';\nconst [values, setValues] = React.useState({ email: '', password: '', username: '' });\n\n  const [errors, setErrors] = React.useState({});\n  const [isValid, setIsValid] = React.useState(false);\n  const [duplicateEmail, setDuplicateEmail] = React.useState(false);\n\n\n  React.useEffect(() => {\n    //debugger;\n    handleCheckToken();\n  }, []);\n\n React.useEffect(() => {\n    if (localStorage.getItem(\"token\")) {\n      getUser();\n    }\n  }, []);\n\n   function handleCheckToken() {\nconst jwt = localStorage.getItem(\"token\");\n\n  if (jwt) {\n  console.log(\"I see the jwt\")\n      mainApi\n        .checkToken(jwt)\n        .then(res => {\n          if (res) {\n            setLoggedin(true);\n            setValues({ email: res.email, password: res.password, username: res.username });\n            console.log(res)\n            history.push('/')\n          }\n        })\n        .catch(err => {\n          console.log(\"Err: \" + err);\n        });\n    }\n  \n  }\n\n\n function fieldValidation() {\n    const validEmailRegex = RegExp(\n      /^\\w+([.-]?\\w+)*@\\w+([.-]?\\w+)*(\\.\\w{2,3})+$/i\n    );\n    setErrors((origErrors) => ({\n      ...origErrors,\n      email: validEmailRegex.test(values.email) ? \"\" : \"Invalid email address\",\n    }));\n\n  }\n\n  function handleSignup(e){ \n    e.preventDefault();\n    mainApi.register(values.email, values.password, values.username)\n    .then((res) =>{\n\n       if (res.message === 'Duplicate User') {      \n         setDuplicateEmail(true)    \n          return Promise.reject(`Error! ${res.message}`);\n        }\n        if (res.ok){\n      return res.json();\n        }\n    })\n    .then(() => {\n        setConfirmationPopupOpen(true);\n        setRegisterPopupOpen(false);\n        setDuplicateEmail(false)       \n        resetForm();\n      })\n      .catch(err => console.log(err));\n  }\n\n\n  // Handle Form Typing\n  const handleChangeForm = (e) => {\n    \n   const { name, value } = e.target;\n\n    const newValues = {\n      ...values,\n      [name]: value,\n    };\n    setValues(newValues);\n    fieldValidation(newValues);\n    setErrors({ ...errors, [name]: errors[name] });\n    setIsValid(e.target.closest('form').checkValidity());\n  };\n\n  const resetForm = useCallback(\n    (\n      newValues = { email: '', password: '', username: '' },\n      newErrors = { email: '', password: '', username: '' },\n      newIsValid = false,\n    ) => {\n      setValues(newValues);\n      setErrors(newErrors);\n      setIsValid(newIsValid);\n    },\n    [setValues, setErrors, setIsValid],\n  );\n\n\n  function getUser() {\n    mainApi\n      .getUserInfo()\n      .then((res) => {\n        setCurrentUser(res);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n\n  function handleSignIn(e) {    \n    e.preventDefault();\n    \n    mainApi\n      .authorize(values.email, values.password)\n      .then(res => {\n      \n        if (res.message === \"Authorization Error\") {\nconsole.log(res)\n          setWrongEmailOrPasswordMessage(true);\n          return Promise.reject(`Error! ${res.message}`);\n        }\n        localStorage.setItem('jwt', res.token);\n        getUser();\n      })\n      .then(() => {\n         handleCheckToken();\n        closeAllPopups();\n        resetForm();\n       \n        // window.location.reload();\n      })\n      .catch(res => {\n        if (res === 400) {\n          console.log('one of the fields was filled in in correctly')\n        }\n        if (res === 401) {\n          console.log('user email not found')\n        }\n      })\n  \n\n  }\n\n\n   function handleSignOut(e) {\n    e.preventDefault();\n    localStorage.removeItem('token');\n    setLoggedin(false);   \n    history.push('/');\n    closeAllPopups();   \n    window.location.reload();\n  }\n\n\nfunction closeAllPopups() {    \n    setLoginPopupOpen(false);\n    setRegisterPopupOpen(false);\n    setMobileNavOpen(false);\n    setConfirmationPopupOpen(false);\n  }\nfunction handleSigninClick() {    \n    setLoginPopupOpen(true);\n    setRegisterPopupOpen(false);\n    setMobileNavOpen(false);\n    setConfirmationPopupOpen(false);\n  }\nfunction handleRegisterLinkClick() {\n    setRegisterPopupOpen(true);\n    setLoginPopupOpen(false);\n    setWrongEmailOrPasswordMessage(false);\n  }\n  function handleMobileClick() {\n    setMobileNavOpen(true);\n  }\n\nfunction handleMobileClose() {\n    setMobileNavOpen(false);\n    }\n  \n  React.useEffect(() => {\n    const handleScreenSizeChange = () => setScreenWidth(window.innerWidth);\n    window.addEventListener(\"resize\", handleScreenSizeChange);\n\nsetIsMobile(screenWidth < 768);\n\n    return () => window.removeEventListener(\"resize\", handleScreenSizeChange);\n  }, [screenWidth]);\n\n\n\n  return (\n     <>\n      <div className=\"page\">\n         <CurrentUserContext.Provider value={currentUser}>\n       <Header \n       values={values}\n       loggedin={Loggedin}\n       savedNewsLocation={savedNewsLocation}\n       onSigninClick={handleSigninClick}\n       onSignOut={handleSignOut}\n       mobile={isMobile}\n       mobileNavOpen={isMobileNavOpen}\n       onHamburgerClick={handleMobileClick}\n       onClose={handleMobileClose}\n       />\n\n         <Switch> \n          <Route exact path='/'>\n            <Main\n        \n            />\n          </Route>\n            <ProtectedRoute\n              exact path='/saved-news'\n              component={SavedNews}\n              loggedin={Loggedin}\n              savedNewsLocation={savedNewsLocation}\n              currentUser={currentUser}\n            />\n        </Switch>\n\n\n       <Footer />\n       <LoginPopup\n          onSignupClick={handleRegisterLinkClick}\n          onClose={closeAllPopups}\n          isOpen={isLoginPopupOpen}\n          onSubmit={handleSignIn}\n          handleChangeForm={handleChangeForm}\n          values={values}\n          isValid={isValid}\n          wrongEmailOrPasswordMessage={wrongEmailOrPasswordMessage}\n        />\n        <RegisterPopup\n          onSigninClick={handleSigninClick}\n          onClose={closeAllPopups}\n          isOpen={isRegisterPopupOpen}\n          onSubmit={handleSignup}\n          handleChangeForm={handleChangeForm}\n          values={values}\n          duplicateEmail={duplicateEmail}\n           isValid={isValid}\n        />\n        <ConfirmationPopup\n        onSigninClick={handleSigninClick}\n        onClose={closeAllPopups}\n        isOpen={isConfirmationPopupOpen}\n        />\n        </CurrentUserContext.Provider>\n       </div>\n     </>\n   );\n }\n\nexport default App;\n\n"]},"metadata":{},"sourceType":"module"}